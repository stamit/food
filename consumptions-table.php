<? $AUTH='consumption';
	require_once 'app/init.php';
	require_once 'app/data.php';
	require_once 'lib/maketable/maketable.php';

	include 'app/begin.php';
	maketable(array(
		'self'=>$URL.'/consumptions-table',
		'key'=>'id',
		'join'=>array(
			'consumption'=>array('user_id'=>$_SESSION['user_id']),
			array('product',array('id'=>'consumption.product'),'group'),
		),
		'columns'=>array(
			'consumption.consumed'=>array('Date', 'consumption_time_html',
				'search'=>'mid',
				'edit'=>'datetime',
				'size'=>19,
			),
			'consumption.weight'=>array('Quant.',
				'fun'=>'consumption_quantity_html',
				'class'=>'number',
				'edit'=>'number',
				'size'=>6,
			),
			'consumption.product'=>array('Product', 'product_name_html',
				'search'=>'mid',
				'search_in'=>'product.name',
				'edit'=>'none',
				#'edit'=>'dropdown',
				#'opts_sql'=>'id AS value, name AS text'
				#            .' FROM product ORDER BY name',
			),
			'consumption.weight*product.energy/product.sample_weight'=>array(
				'Energy',
				'f'=>'quantity_html',
				'postfix'=>'kcal',
				'class'=>'number',
			),
			'consumption.weight*product.water/product.sample_weight'=>array(
				'H₂O',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.proteins/product.sample_weight'=>array(
				'Pr.',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.carbohydrates/product.sample_weight'=>array(
				'Carb.',
				'tip'=>'Υδατάνθρακες',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.sugars/product.sample_weight'=>array(
				'Sug.',
				'tip'=>'Σάκχαρα',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.fats/product.sample_weight'=>array(
				'Fat',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.fats_saturated/product.sample_weight'=>array(
				'S.F.',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.total_fiber/product.sample_weight'=>array(
				'Fiber',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.sodium/product.sample_weight'=>array('Na',
				'f'=>'quantity_html',
				'postfix'=>'g',
				'class'=>'number',
			),
			'consumption.weight*product.calcium/product.sample_weight'=>array('Ca',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.phosphorus/product.sample_weight'=>array('P',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.magnesium/product.sample_weight'=>array('Mg',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.iron/product.sample_weight'=>array('Fe',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.a/product.sample_weight'=>array('A',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.b1/product.sample_weight'=>array('B₁',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.b2/product.sample_weight'=>array('B₂',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.b3/product.sample_weight'=>array('B₃',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.b6/product.sample_weight'=>array('B₆',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.b12/product.sample_weight'=>array('B₁₂',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
				'postfix'=>'μ',
			),
			'consumption.weight*product.c/product.sample_weight'=>array('C',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
			'consumption.weight*product.d/product.sample_weight'=>array('D',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
				'postfix'=>'μ',
			),
			'consumption.weight*product.e/product.sample_weight'=>array('E',
				'f'=>'quantity_html',
				#'postfix'=>'mg',
				'class'=>'number',
			),
		),
		'hidden'=>array(
			'consumption.volume',
			'consumption.units',
			'product.name',
		),
		'orderby'=>'consumption.consumed',
		'userorder'=>true,

		'update'=>1,
		'updateinc'=>'consumption.php',

		'delete'=>1,
		'deleteinc'=>'consumption.php',
		'deleteneg'=>true,
	));
	return include 'app/end.php';
?>
